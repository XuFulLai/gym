<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/book.css">
    <style>
        .nav-item-active {
            background-color: #E6DA08;
        }
    </style>
</head>
<body>


<div class="topLine">
    Sports reservation center
</div>

<header>
    <div class="nav">
        <div class="nav-item">
            <div class="nav-item-icons">
                <img class="nav-item-icon" src="pic/nav1.png" alt="">
                <img class="nav-item-icon-select" src="pic/nav1-select.png" alt="">
            </div>
            <div class="nav-item-title"><a th:href="@{/Basketball}">Basketball</a></div>
        </div>
        <div class="nav-item">
            <div class="nav-item-icons">
                <img class="nav-item-icon" src="pic/nav2.png" alt="">
                <img class="nav-item-icon-select" src="pic/nav2-select.png" alt="">

            </div>
            <div class="nav-item-title"><a th:href="@{/badminton}">badminton</a></div>
        </div>
        <div class="nav-item nav-item-active">
            <div class="nav-item-icons">
                <img class="nav-item-icon" src="pic/nav3.png" alt="">
                <img class="nav-item-icon-select" src="pic/nav3-select.png" alt="">
            </div>
            <div class="nav-item-title"><a th:href="@{/tennis}">tennis</a></div>
        </div>

        <div class="nav-item">
            <div class="nav-item-icons">
                <img class="nav-item-icon" src="pic/nav5.png" alt="">
                <img class="nav-item-icon-select" src="pic/nav5-select.png" alt="">

            </div>
            <div class="nav-item-title"><a th:href="@{/PingPang}">PingPang</a></div>
        </div>
        <div class="nav-item">
            <div class="nav-item-icons">
                <img class="nav-item-icon" src="pic/nav6.png" alt="">
                <img class="nav-item-icon-select" src="pic/nav6-select.png" alt="">
            </div>
            <div class="nav-item-title"><a th:href="@{/gym}">gym</a></div>
        </div>


        <div class="nav-item">
            <div class="nav-item-icons">
                <img class="nav-item-icon" src="pic/nav8.png" alt="">
                <img class="nav-item-icon-select" src="pic/nav8-select.png" alt="">
            </div>
            <div class="nav-item-title"><a th:href="@{/WuShu}">WuShu</a></div>
        </div>

        <div class="nav-item">
            <div class="nav-item-icons">
                <img class="nav-item-icon" src="pic\nav8.png" alt="">
                <img class="nav-item-icon-select" src="pic\nav8-select.png" alt="">
            </div>
            <div class="nav-item-title"><a th:href="@{/orderList}">Order</a></div>
        </div>

    </div>

</header>
<div class="sports" id="page1">
    <div class="main-box">
        <div class="main-left">
            <div class="timenav">
                <div class="timenav-select">
                    <div class="time-nav-select-box time-nav-select-box-active">Book</div>
                </div>
                <div class="timenav-session">
                    <div class="timenav-session-box">
                        <div class="timenav-session-item">
                            <div class="timenav-session-title"><a href="#" onclick="showDate('Wednesday')">Wednesday
                                <br>04/18</a></div>

                        </div>
                        <div class="timenav-session-item">
                            <div class="timenav-session-title"><a href="#" onclick="showDate('Thursday')">Thursday <br>04/19</a>
                            </div>

                        </div>
                        <div class="timenav-session-item">
                            <div class="timenav-session-title"><a href="#" onclick="showDate('Friday')">Friday <br>04/20</a>
                            </div>

                        </div>
                        <div class="timenav-session-item">
                            <div class="timenav-session-title"><a href="#" onclick="showDate('Saturday')">Saturday <br>04/21</a>
                            </div>

                        </div>
                        <div class="timenav-session-item">
                            <div class="timenav-session-title"><a href="#" onclick="showDate('Sunday')">Sunday <br>04/22</a>
                            </div>

                        </div>
                        <div class="timenav-session-item">
                            <div class="timenav-session-title"><a href="#" onclick="showDate('Monday')">Monday <br>04/23</a>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
            <div class="field">
                <div class="field-button field-active">网球场地</div>
            </div>
            <div class="example">
                <div class="example-container">
                    <div class="example1">
                        <div class="example-box"></div>
                        <div class="example-text">可选</div>
                    </div>
                    <div class="example2">
                        <div class="example-box"></div>
                        <div class="example-text">已选</div>
                    </div>
                    <div class="example3">
                        <div class="example-box"></div>
                        <div class="example-text">不可选</div>
                    </div>
                </div>
            </div>
            <div class="tableChoose">
                <table>
                    <tr>
                        <th></th>
                        <th>Court1</th>
                        <th>Court2</th>

                    </tr>
                    <tr>
                        <td>10:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '10:00', 80)"> <br> $80.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '10:00',80)"> <br> $80.00</td>

                    </tr>
                    <tr>
                        <td>11:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '11:00', 80)"> <br>$80.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '11:00', 80)"> <br>$80.00</td>

                    </tr>
                    <tr>
                        <td>12:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '12:00', 80)"> <br>$80.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '12:00', 80)"> <br>$80.00</td>

                    </tr>
                    <tr>
                        <td>13:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '13:00', 80)"> <br>$80.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '13:00', 80)"> <br>$80.00</td>

                    </tr>

                    <tr>
                        <td>14:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '14:00', 80)"> <br>$80.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '14:00', 80)"> <br>$80.00</td>

                    </tr>
                    <tr>
                        <td>15:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '15:00', 80)"> <br>$80.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '15:00', 80)"> <br>$80.00</td>

                    </tr>
                    <tr>
                        <td>16:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '16:00', 60)"> <br>$60.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '16:00', 60)"> <br>$60.00</td>

                    </tr>
                    <tr>
                        <td>17:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '17:00', 60)"> <br>$60.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '17:00', 60)"> <br>$60.00</td>

                    </tr>
                    <tr>
                        <td>18:00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 1', '18:00', 100)"> <br>$100.00</td>
                        <td><input type="checkbox" onchange="updateSummary('Court 2', '18:00', 100)"> <br>$100.00</td>

                    </tr>
                </table>
            </div>
        </div>
        <div class="main-right">
            <div id="totalBooking">
                <h2>Booking information</h2>
                <p>sports: Tennis</p>
                <p>Selected Time and Positions: None</p>
                <p>Total Amount: $0.00</p>
                <div class="confirm-button">
                    <button onclick="pay()">Pay Now</button>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="myModal" class="modal">
    <div class="modal-content">
        <span onclick="closeModal()" style="float: right; cursor: pointer;">&times;</span>
        <h2>Scan the QR Code to Complete Payment</h2>
        <div id="qrcode" class="middle"></div>
        <p id="countdown"></p>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>


<script src="js/book.js">
</script>
<script>

    const payList = [];

    function updateSummary(venue, time, price) {
        console.log(venue, time, price)
        var payObj = {};
        payObj.vuenue = venue;
        payObj.time = time;
        payObj.price = price;
        payObj.sportName = "tennis";
        payList.push(payObj);
        var summary = document.getElementById('totalBooking');
        var selected = document.querySelectorAll('input[type="checkbox"]:checked');
        var selectedTimeVenue = "Selected Time and Positions: ";
        var totalAmount = 0;
        for (var i = 0; i < selected.length; i++) {
            var row = selected[i].parentNode.parentNode.rowIndex;
            var col = selected[i].parentNode.cellIndex;
            var selectedVenue = selected[i].parentNode.parentNode.cells[0].textContent;
            var selectedTime = selected[i].parentNode.parentNode.parentNode.rows[0].cells[col].textContent;
            selectedTimeVenue += selectedVenue + " - " + selectedTime + ", ";
            totalAmount += price;
        }
        if (selected.length === 0) {
            summary.children[2].textContent = "Selected Time and Positions: None";
            summary.children[3].textContent = "Total Amount: $0.00";
        } else {
            summary.children[2].textContent = selectedTimeVenue.slice(0, -2);
            summary.children[3].textContent = "Total Amount: $" + totalAmount.toFixed(2);
        }
    }

    // 获取当前日期
    var today = new Date();

    // 获取最近一周的起始日期（上周日）
    var startDate = new Date(today);
    startDate.setDate(today.getDate() - today.getDay());

    // 更新链接文本中的日期
    for (var i = 0; i <= 6; i++) {
        var currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i);
        var formattedDate = (currentDate.getMonth() + 1) + '/' + currentDate.getDate();
        document.getElementById('date' + getDayOfWeek(i)).textContent = formattedDate;
    }

    // 根据索引获取星期几的名称
    function getDayOfWeek(index) {
        var daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        return daysOfWeek[index];
    }

    // 根据点击的链接显示对应日期的相关信息
    function showDate(day) {
        var dateElement = document.getElementById('date' + day);
        var dateText = dateElement.textContent;
    }

    function pay() {
        // 构造订单请求对象
        var payReq = {
            payList
        };

        // 发送 POST 请求到服务器
        fetch('/pay', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payReq)
        })
            .then(response => {
                if (response.ok) {
                    return response.text(); // 返回支付成功信息
                } else {
                    throw new Error('Payment failed');
                }
            })
            .then(data => {
                showSuccessMessage();
            })
            .catch(error => {
                console.error('Error:', error); // 捕获异常并输出
            });
    }

    function showSuccessMessage() {
        // 创建一个提示框元素
        var successMessage = document.createElement('div');
        successMessage.textContent = 'Payment successful!'; // 设置提示消息文本
        successMessage.style.backgroundColor = 'green'; // 设置背景颜色
        successMessage.style.color = 'white'; // 设置文本颜色
        successMessage.style.padding = '10px'; // 设置内边距
        successMessage.style.position = 'fixed'; // 设置定位方式
        successMessage.style.top = '50%'; // 设置距离顶部的位置
        successMessage.style.left = '50%'; // 设置距离左侧的位置
        successMessage.style.transform = 'translate(-50%, -50%)'; // 将提示框居中显示
        successMessage.style.zIndex = '9999'; // 设置层级

        // 将提示框添加到页面中
        document.body.appendChild(successMessage);

        // 3秒后移除提示框
        setTimeout(function() {
            document.body.removeChild(successMessage);
        }, 3000);
    }
</script>
</body>
</html>
